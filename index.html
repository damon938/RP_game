<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carte Joueur RPG</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Poppins', sans-serif; background: #1a1a1a; color: #eee; padding: 20px; }
  h1 { text-align: center; font-family: 'Cinzel Decorative', serif; font-size: 2.5em; color: #ffd700; }
  .input-container { text-align: center; margin-bottom: 20px; }
  input, button { padding: 10px; font-size: 16px; border-radius: 5px; border: none; }
  input { width: 200px; margin-right: 10px; }
  button { background: #4CAF50; color: #fff; cursor: pointer; }
  #error { color: #ff4d4d; text-align: center; margin-bottom: 10px; }

  .player-card {
    background: #2a2a2a; 
    padding: 20px; 
    border-radius: 15px; 
    max-width: 750px; 
    margin: 0 auto; 
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  .player-card h2 { text-align: center; font-family: 'Cinzel Decorative', serif; color: #ffd700; margin-bottom: 15px; }
  .player-card .row { display: flex; justify-content: space-between; flex-wrap: wrap; margin: 5px 0; }
  .player-card .col { flex: 1 1 30%; margin: 3px 0; min-width: 120px; }
  .player-card p { margin: 2px 0; }
  .stat-bar {
    background: #444; 
    border-radius: 10px; 
    overflow: hidden; 
    margin: 5px 0; 
    height: 20px;
    position: relative;
  }
  .stat-fill {
    height: 100%; 
    text-align: right; 
    padding-right: 5px; 
    color: #fff; 
    font-weight: bold;
    width: 0%;
    transition: width 1s ease;
  }
  .pv { background: #ff4d4d; }
  .pm { background: #4d79ff; }
  .pf { background: #ffa64d; }
  .pe { background: #33cc33; }
  .vitesse { background: #ffcc00; }
  .icon { margin-right: 5px; }
</style>
</head>
<body>

<h1>Carte Joueur RPG</h1>

<div class="input-container">
  <input type="text" id="playerId" placeholder="Entrez l'ID du joueur">
  <button onclick="getPlayer()">Chercher</button>
</div>

<div id="error"></div>
<div id="player" class="player-card" style="display:none;"></div>

<script>
const apiUrl = 'https://sheetdb.io/api/v1/gejh59h045ck0';

function safeValue(obj, key) {
  if (!obj.hasOwnProperty(key) || obj[key] === null || obj[key].toString().trim() === "") {
    return "VIDE";
  }
  return obj[key];
}


const keyMapping = {
  "Nom": ["Nom", "nom", "Name"],
  "Race": ["Race", "race"],
  "Classe": ["Classe", "classe", "Class"],
  "Niveau": ["Niveau", "niveau", "Level"],
  "Rang": ["Rang", "rang"],
  "Argent": ["Argent", "argent", "Money"],
  "Victoires": ["Victoires", "victoires", "Wins"],
  "Defaites": ["Defaites", "D√©faites", "defaites", "Losses"],
  "Quetes": ["Quetes", "Qu√™tes", "quetes", "quests"],
  "PV": ["PV", "pv", "Hp"],
  "PM": ["PM", "pm", "Mp"],
  "PF": ["PF", "pf"],
  "PE": ["PE", "pe"],
  "Vitesse": ["Vitesse", "vitesse", "Speed"],
  "Competence": ["Competence", "Comp√©tence", "Skill"],
  "Attribut": ["Attribut", "attribut", "Attribute"],
  "Familier": ["Familier", "familier", "Pet"],
  "XP": ["XP", "xp", "Exp"]
};

// Fonction pour trouver la bonne cl√© dans l'objet
function getMappedValue(obj, displayKey) {
  const possibleKeys = keyMapping[displayKey];
  for (let k of possibleKeys) {
    if (obj.hasOwnProperty(k)) {
      return safeValue(obj, k);
    }
  }
  return "VIDE";
}

function getPlayer() {
  const playerId = document.getElementById('playerId').value.trim();
  const playerDiv = document.getElementById('player');
  const errorDiv = document.getElementById('error');
  playerDiv.style.display = 'none';
  errorDiv.textContent = '';

  if (!playerId) {
    errorDiv.textContent = 'Veuillez entrer un ID.';
    return;
  }

  fetch(`${apiUrl}/search?id=${playerId}`)
    .then(res => res.json())
    .then(data => {
      if(!data || data.length === 0) {
        errorDiv.textContent = 'Joueur inconnu';
        return;
      }

      const p = data[0];
      console.log("Toutes les cl√©s JSON :", Object.keys(p)); // debug

      // R√©cup√©ration des valeurs via mapping
      const Nom = getMappedValue(p, "Nom");
      const Race = getMappedValue(p, "Race");
      const Classe = getMappedValue(p, "Classe");
      const Niveau = getMappedValue(p, "Niveau");
      const Rang = getMappedValue(p, "Rang");
      const Argent = getMappedValue(p, "Argent");
      const Victoires = getMappedValue(p, "Victoires");
      const Defaites = getMappedValue(p, "Defaites");
      const Quetes = getMappedValue(p, "Quetes");
      const PV = getMappedValue(p, "PV");
      const PM = getMappedValue(p, "PM");
      const PF = getMappedValue(p, "PF");
      const PE = getMappedValue(p, "PE");
      const Vitesse = getMappedValue(p, "Vitesse");
      const Competence = getMappedValue(p, "Competence");
      const Attribut = getMappedValue(p, "Attribut");
      const Familier = getMappedValue(p, "Familier");
      const XP = getMappedValue(p, "XP");

      playerDiv.innerHTML = `
        <h2>${Nom}</h2>
        <div class="row">
          <div class="col"><strong>Race:</strong> ${Race}</div>
          <div class="col"><strong>Classe:</strong> ${Classe}</div>
          <div class="col"><strong>Niveau:</strong> ${Niveau}</div>
        </div>
        <div class="row">
          <div class="col"><strong>Rang:</strong> ${Rang}</div>
          <div class="col"><strong>Argent:</strong> ${Argent}</div>
          <div class="col"><strong>XP:</strong> ${XP}</div>
        </div>
        <div class="row">
          <div class="col"><strong>Victoires:</strong> ${Victoires}</div>
          <div class="col"><strong>D√©faites:</strong> ${Defaites}</div>
          <div class="col"><strong>Qu√™tes:</strong> ${Quetes}</div>
        </div>
        <div class="row">
          <div class="col"><strong>Comp√©tence:</strong> ${Competence}</div>
          <div class="col"><strong>Attribut:</strong> ${Attribut}</div>
          <div class="col"><strong>Familier:</strong> ${Familier}</div>
        </div>

        <p><span class="icon">‚ù§Ô∏è</span>PV:</p>
        <div class="stat-bar"><div class="stat-fill pv">${PV}</div></div>

        <p><span class="icon">üîµ</span>PM:</p>
        <div class="stat-bar"><div class="stat-fill pm">${PM}</div></div>

        <p><span class="icon">üí™</span>PF:</p>
        <div class="stat-bar"><div class="stat-fill pf">${PF}</div></div>

        <p><span class="icon">‚ö°</span>PE:</p>
        <div class="stat-bar"><div class="stat-fill pe">${PE}</div></div>

        <p><span class="icon">üèÉ‚Äç‚ôÇÔ∏è</span>Vitesse:</p>
        <div class="stat-bar"><div class="stat-fill vitesse">${Vitesse}</div></div>
      `;

      playerDiv.style.display = 'block';

      
      document.querySelectorAll('.stat-fill').forEach(fill => {
        const value = parseInt(fill.textContent) || 0;
        fill.style.width = value + '%';
      });

    })
    .catch(err => {
      console.error(err);
      errorDiv.textContent = 'Erreur lors de la r√©cup√©ration des donn√©es';
    });
}
</script>

</body>
</html>
